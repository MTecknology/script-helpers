#!/bin/sh
##
# Find and run test units on shell scripts
##

# Repository root
TESTDIR="$(dirname "$0")"; export TESTDIR


main() {
	TESTS_FAILED='false'

	# Run tests
	run_tests 'Constant'
	run_tests 'Function'

	# Print summary
	if [ "$TESTS_FAILED" = 'true' ]; then
		printf '!!! One or more tests failed. !!!\n'
		return 1
	fi
	return 0
}


run_tests() {
	printf 'Running %s Tests...\n' "$1"

	for path in "$TESTDIR/shell_units/$1/"*; do
		file="$(basename "$path")"
		# Skip files starting with an underscore
		[ "$file" = "${file#_}" ] || continue

		# Run test unit
		printf '%24s:\t' "$file"
		if ! (sh "$path"); then
			printf 'FAILED\n'
			TESTS_FAILED='true'
		else
			printf 'Passed\n'
		fi
	done
}


main "$@"
